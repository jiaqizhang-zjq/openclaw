# OpenClaw 项目框架

## 项目概述

OpenClaw 是一个开源的 AI 代理框架，支持多通道、多模型、可扩展的 AI 助手系统。

## 目录结构

```
openclaw/
├── src/                    # 源代码目录
│   ├── agents/            # 代理核心模块（LLM相关）
│   ├── auto-reply/        # 自动回复模块
│   ├── channels/          # 通道模块
│   ├── cli/               # 命令行工具
│   ├── commands/          # 命令实现
│   ├── config/            # 配置管理
│   ├── cron/              # 定时任务
│   ├── gateway/           # 网关服务
│   ├── memory/            # 记忆系统
│   ├── plugins/           # 插件系统
│   └── wizard/            # 引导流程
├── skills/                # 技能模块
├── extensions/            # 扩展模块
├── docs/                  # 官方文档
├── doc/                   # 本项目框架文档
└── ui/                    # 前端界面
```

## 核心模块详解

### 1. Agents 模块（src/agents/）

这是整个系统的核心，负责 LLM 交互、工具调用、子代理管理等。

#### 主要文件：

- **system-prompt.ts**: 系统提示构建，为代理生成包含工具、工作区等信息的系统提示
- **pi-tools.ts**: 工具系统，创建和管理 OpenClaw 的工具集合
- **subagent-spawn.ts**: 子代理生成，负责生成和管理子代理会话
- **subagent-registry.ts**: 子代理注册表，管理子代理的运行状态
- **subagent-announce.ts**: 子代理通知，处理子代理完成后的通知流程
- **skills.ts**: 技能系统，管理和加载各种技能
- **model-selection.ts**: 模型选择，处理模型配置和选择逻辑

#### 子目录：

- **tools/**: 工具相关的辅助函数
  - sessions-helpers.ts: 会话管理工具
  - subagents-tool.ts: 子代理工具
  - sessions-spawn-tool.ts: 会话生成工具

### 2. Auto-Reply 模块（src/auto-reply/）

负责自动回复和消息处理流程。

### 3. Memory 模块（src/memory/）

负责 AI 代理的记忆管理，支持向量检索、混合记忆等。

### 4. Channels 模块（src/channels/）

支持多种通信渠道：Telegram、Signal、Slack、Discord 等。

### 5. Gateway 模块（src/gateway/）

负责服务网关和 API 接口。

### 6. Cron 模块（src/cron/）

负责定时任务和自动化。

### 7. Skills 目录（skills/）

存放各种预定义的技能模块，每个技能都是一个独立的功能模块。

## LLM 相关核心概念

### 1. Session（会话）

会话是 OpenClaw 的基本交互单位，每个会话对应一个独立的对话上下文。

- **主会话**: 用户直接交互的主会话
- **子代理会话**: 由主会话生成的子代理执行任务的会话
- **定时任务会话**: 由定时任务触发的会话

### 2. Prompt（提示）

系统提示指导 AI 代理的行为，包括：

- **系统提示**: 包含工具、工作区、运行时信息
- **用户提示**: 用户输入的内容
- **技能提示**: 技能相关的提示内容

### 3. Tool（工具）

代理可以调用的工具集合：

- **文件工具**: read、write、edit、find、grep
- **执行工具**: exec、process
- **网络工具**: web_search、web_fetch、browser
- **管理工具**: subagents、sessions_spawn、cron 等

### 4. Skills（技能）

预定义的功能模块，扩展代理的能力。

### 5. Subagent（子代理）

代理可以生成子代理来处理复杂或耗时的任务，实现任务分解和并行处理。

## 数据流

```
用户消息
    ↓
Gateway（网关）
    ↓
Session Management（会话管理）
    ↓
Agent Runtime（代理运行时）
    ↓
System Prompt Build（系统提示构建）
    ↓
Tool Creation（工具创建）
    ↓
LLM Call（LLM 调用）
    ↓
Tool Execution（工具执行）
    ↓
Response Generation（响应生成）
    ↓
Channel Delivery（通道传递）
```

## 关键技术栈

- **TypeScript**: 主要开发语言
- **pi-ai / pi-coding-agent**: 底层 AI 代理框架
- **Node.js**: 运行时环境
- **SQLite**: 记忆存储
- **Vite**: 前端构建工具
